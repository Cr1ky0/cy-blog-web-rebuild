"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[307],{56993:function(t,e,n){n.d(e,{HF:function(){return p},O6:function(){return o},Qv:function(){return d},X$:function(){return u},sA:function(){return f},uB:function(){return l},wP:function(){return s}});var r=n(74165),a=n(15861),i=n(49134),c=n(74546),o=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.Z.post("/api/images",e);case 2:return n=t.sent,t.abrupt("return",Promise.resolve(n));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a,i,o,s,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.page,a=e.limit,i=e.fields,o=e.sort,s=e.options,t.next=3,c.Z.get("/api/images/photos?"+(n?"page=".concat(n,"&"):"")+(a?"limit=".concat(a,"&"):"")+(i?"fields=".concat(i,"&"):"")+(o?"sort=".concat(o,"&"):"")+(s?"".concat(s):""));case 3:return u=t.sent,t.abrupt("return",Promise.resolve(u));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),u=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a,i,o,s,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.page,a=e.limit,i=e.fields,o=e.sort,s=e.options,t.next=3,c.Z.get("/api/images/self/photos?"+(n?"page=".concat(n,"&"):"")+(a?"limit=".concat(a,"&"):"")+(i?"fields=".concat(i,"&"):"")+(o?"sort=".concat(o,"&"):"")+(s?"".concat(s):""));case 3:return u=t.sent,t.abrupt("return",Promise.resolve(u));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),l=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.Z.delete("/api/images",{data:{filename:e}}),t.abrupt("return",Promise.resolve(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.Z.delete("/api/images/delete/many",{data:{fileList:e}}),t.abrupt("return",Promise.resolve(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),f=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.Z.get("/api/images/counts?classification=".concat(e)),t.abrupt("return",Promise.resolve(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),p=(0,i.d)(function(){var t=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c.Z.patch("/api/images",e),t.abrupt("return",Promise.resolve(n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},50307:function(t,e,n){n.r(e),n.d(e,{default:function(){return H}});var r=n(74165),a=n(15861),i=n(29439),c=n(72791),o=n(57689),s=n(11087),u=n(72426),l=n.n(u),d=n(82339),f=n(87309),p=n(66818),h=n(31378),m=n(82622),v=n(1413),_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"}}]},name:"form",theme:"outlined"},g=n(54291),Z=function(t,e){return c.createElement(g.Z,(0,v.Z)((0,v.Z)({},t),{},{ref:e,icon:_}))};Z.displayName="FormOutlined";var x=c.forwardRef(Z),k=n(31752),w={dark:"EditCertain_dark__DGdUu","dark-2":"EditCertain_dark-2__MgyW0","dark-3":"EditCertain_dark-3__Ft4zk","dark-3-onforce":"EditCertain_dark-3-onforce__Z3X2z",light:"EditCertain_light__Z8qc4","light-1":"EditCertain_light-1__ubFj5","dark-font":"EditCertain_dark-font__-MnB2","dark-back-2-onforce-no-trans":"EditCertain_dark-back-2-onforce-no-trans__AGdnu",hoverDark:"EditCertain_hoverDark__JdmvQ",hoverLight:"EditCertain_hoverLight__XfMOJ","light-font":"EditCertain_light-font__G-DuM",mark:"EditCertain_mark__GzTC6",transBase:"EditCertain_transBase__aZpDC",transHide:"EditCertain_transHide__bUsEp",showAnime:"EditCertain_showAnime__gYOOZ",hideAnime:"EditCertain_hideAnime__Pa+k-","show-anime-delay-1s":"EditCertain_show-anime-delay-1s__3w+Kh","show-anime-no-delay":"EditCertain_show-anime-no-delay__XUP0L",wrapper:"EditCertain_wrapper__Z6lVB",tip:"EditCertain_tip__kOnRB",func:"EditCertain_func__Ybh2x",editBtn:"EditCertain_editBtn__lhee1"},C=n(44871),b=n(56993),E=n(41279),y=n(74185),j=function(t){return t.memory="\u5f80\u4e8b\u56de\u5fc6",t.bigEvent="\u5927\u4e8b\u8bb0",t.now="\u5373\u65f6\u4e0a\u4f20",t.others="\u5176\u4ed6",t}({}),z=function(t){return t["\u5f80\u4e8b\u56de\u5fc6"]="magenta",t["\u5927\u4e8b\u8bb0"]="geekblue",t["\u5373\u65f6\u4e0a\u4f20"]="purple",t["\u5176\u4ed6"]="green",t}({}),M=n(80635),P=n(71249),B=n(80184),A=function(t){return t.map((function(t){var e=t._id,n=t.filename,r=t.uploadAt,a=t.photoTime,i=t.url,c=t.classification;return{key:e,id:e,url:i+n,filename:n,uploadAt:l()(r).format("YYYY-MM-DD"),photoTime:l()(a).format("YYYY-MM-DD"),classification:j[c]}}))},H=function(){var t=(0,y.J)(),e=(0,E.z)(),n=(0,o.s0)(),u=(0,C.TL)(),l=(0,o.TH)().state,v=(0,s.lr)(),_=(0,i.Z)(v,1)[0].get("page"),g=(0,c.useState)([]),Z=(0,i.Z)(g,2),j=Z[0],H=Z[1],L=(0,c.useState)(0),O=(0,i.Z)(L,2),S=O[0],Y=O[1],D=(0,c.useState)([]),I=(0,i.Z)(D,2),N=I[0],F=I[1],T=(0,c.useState)(l),X=(0,i.Z)(T,2),G=X[0],J=X[1],Q=(0,c.useMemo)((function(){return[{title:"id",dataIndex:"id"},{title:"\u6587\u4ef6\u540d",dataIndex:"filename"},{title:"\u9884\u89c8",dataIndex:"url",render:function(t,e){var n=e.url;return(0,B.jsx)("img",{src:n+"?x-oss-process=image/quality,10",alt:"photo",style:{maxHeight:100,maxWidth:100}},n)}},{title:"\u5206\u7c7b",dataIndex:"classification",render:function(t,e){var n=e.classification;return(0,B.jsx)(d.Z,{color:z[n],children:n},n)}},{title:"\u4e0a\u4f20\u65f6\u95f4",dataIndex:"uploadAt"},{title:"\u7167\u7247\u65f6\u95f4",dataIndex:"photoTime"},{title:"\u5220\u9664",dataIndex:"del",render:function(i,c){var o=c.filename;return(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(f.ZP,{icon:(0,B.jsx)(m.Z,{}),onClick:function(){t.confirm({title:"\u63d0\u793a",content:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u7167\u7247\u5417\uff1f",onOk:function(){(0,b.uB)(o,(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadingSuccessAsync("\u5220\u9664\u4e2d...","\u5220\u9664\u6210\u529f!");case 2:n(0);case 3:case"end":return t.stop()}}),t)}))),(function(t){e.error(t)}))}})},danger:!0,children:"\u5220\u9664"})})}}]}),[]);return(0,c.useEffect)((function(){u((0,P.Y)(l)),J(l)}),[l]),(0,c.useEffect)((function(){(0,b.X$)({page:_||1,limit:6,fields:"",sort:"-_id",options:"classification=".concat(l)},(function(t){var e=_?parseInt(_):1;!t.data.images.length&&e>1&&n("/backstage/editPhoto?page=".concat(e-1),{state:l}),H(t.data.images)}),(function(t){e.error(t)})),(0,b.sA)(l,(function(t){Y(t.data.count)}),(function(t){e.error(t)}))}),[l,_]),(0,B.jsxs)("div",{className:w.wrapper,children:[(0,B.jsxs)("div",{className:w.tip,children:[(0,B.jsx)("span",{children:"\u6279\u91cf\u64cd\u4f5c"}),(0,B.jsx)(x,{style:{color:M.l1}})]}),(0,B.jsxs)("div",{className:w.func,children:[(0,B.jsx)("span",{children:"\u9009\u62e9\u5206\u7c7b\uff1a"}),(0,B.jsx)(p.Z,{value:G,style:{width:160},onChange:function(t){J(t)},disabled:!N.length,options:[{value:"now",label:"\u5373\u65f6\u4e0a\u4f20"},{value:"memory",label:"\u5f80\u4e8b\u56de\u5fc6"},{value:"bigEvent",label:"\u5927\u4e8b\u8bb0"},{value:"others",label:"\u5176\u4ed6"}]}),(0,B.jsx)(f.ZP,{className:w.editBtn,icon:(0,B.jsx)(k.Z,{}),disabled:!N.length,onClick:function(){t.confirm({title:"\u63d0\u793a",content:"\u662f\u5426\u4fee\u6539\u8fd9\u4e9b\u76f8\u7247\u7684\u5206\u7c7b\uff1f",onOk:function(){(0,b.HF)({fileList:N,classification:G},(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadingSuccessAsync("\u4fee\u6539\u4e2d...","\u4fee\u6539\u6210\u529f\uff01");case 2:n(0);case 3:case"end":return t.stop()}}),t)}))),(function(t){e.error(t)}))}})},children:"\u4fee\u6539"}),(0,B.jsx)(f.ZP,{className:w.editBtn,icon:(0,B.jsx)(m.Z,{}),danger:!0,disabled:!N.length,onClick:function(){t.confirm({title:"\u63d0\u793a",content:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e9b\u7167\u7247\u5417\uff1f",onOk:function(){(0,b.Qv)(N,(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadingSuccessAsync("\u5220\u9664\u4e2d...","\u5220\u9664\u6210\u529f\uff01");case 2:n(0);case 3:case"end":return t.stop()}}),t)}))))}})},children:"\u5220\u9664"})]}),(0,B.jsx)("div",{className:w.table,children:(0,B.jsx)(h.Z,{rowSelection:{type:"checkbox",onChange:function(t,e){F(e.map((function(t){return t.filename})))}},pagination:{position:["bottomCenter"],pageSize:6,total:S,current:_?parseInt(_):1,showSizeChanger:!1,showQuickJumper:!1,onChange:function(t){n("/backstage/editPhoto?page=".concat(t),{state:l})}},columns:Q,dataSource:A(j)})})]})}},82622:function(t,e,n){n.d(e,{Z:function(){return s}});var r=n(1413),a=n(72791),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},c=n(54291),o=function(t,e){return a.createElement(c.Z,(0,r.Z)((0,r.Z)({},t),{},{ref:e,icon:i}))};o.displayName="DeleteOutlined";var s=a.forwardRef(o)},31752:function(t,e,n){n.d(e,{Z:function(){return s}});var r=n(1413),a=n(72791),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},c=n(54291),o=function(t,e){return a.createElement(c.Z,(0,r.Z)((0,r.Z)({},t),{},{ref:e,icon:i}))};o.displayName="EditOutlined";var s=a.forwardRef(o)}}]);
//# sourceMappingURL=307.65b603e0.chunk.js.map