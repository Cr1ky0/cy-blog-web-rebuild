"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[1654],{32867:function(e,n,t){t.d(n,{Kb:function(){return i},l7:function(){return s},ti:function(){return c}});var r=t(74165),a=t(15861),u=t(74546),o=t(49134),i=(0,o.d)((0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.get("/api/policy");case 2:return n=e.sent,e.abrupt("return",Promise.resolve(n));case 4:case"end":return e.stop()}}),e)})))),s=(0,o.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.post("/api/policy/setConfig",n);case 2:return t=e.sent,e.abrupt("return",Promise.resolve(t));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),c=(0,o.d)((0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.get("/api/policy/getConfig");case 2:return n=e.sent,e.abrupt("return",Promise.resolve(n));case 4:case"end":return e.stop()}}),e)}))))},56993:function(e,n,t){t.d(n,{HF:function(){return d},O6:function(){return i},Qv:function(){return f},X$:function(){return c},sA:function(){return p},uB:function(){return l},wP:function(){return s}});var r=t(74165),a=t(15861),u=t(49134),o=t(74546),i=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.Z.post("/api/images",n);case 2:return t=e.sent,e.abrupt("return",Promise.resolve(t));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),s=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a,u,i,s,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.page,a=n.limit,u=n.fields,i=n.sort,s=n.options,e.next=3,o.Z.get("/api/images/photos?"+(t?"page=".concat(t,"&"):"")+(a?"limit=".concat(a,"&"):"")+(u?"fields=".concat(u,"&"):"")+(i?"sort=".concat(i,"&"):"")+(s?"".concat(s):""));case 3:return c=e.sent,e.abrupt("return",Promise.resolve(c));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),c=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a,u,i,s,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.page,a=n.limit,u=n.fields,i=n.sort,s=n.options,e.next=3,o.Z.get("/api/images/self/photos?"+(t?"page=".concat(t,"&"):"")+(a?"limit=".concat(a,"&"):"")+(u?"fields=".concat(u,"&"):"")+(i?"sort=".concat(i,"&"):"")+(s?"".concat(s):""));case 3:return c=e.sent,e.abrupt("return",Promise.resolve(c));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),l=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.Z.delete("/api/images",{data:{filename:n}}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),f=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.Z.delete("/api/images/delete/many",{data:{fileList:n}}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),p=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.Z.get("/api/images/counts?classification=".concat(n)),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),d=(0,u.d)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.Z.patch("/api/images",n),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},61654:function(e,n,t){t.r(n),t.d(n,{default:function(){return D}});var r=t(1413),a=t(93433),u=t(74165),o=t(15861),i=t(29439),s=t(72791),c=t(25984),l=t(55518),f=t(66818),p=t(16726),d=t(20088),v=t(54302),m=t(66776),h=(t(77490),"AddPhoto_wrapper__e9lIg"),Z="AddPhoto_classSelect__SDwez",g="AddPhoto_photoTime__jWLWV",x="AddPhoto_upload__Qh+Q9",w=t(41279),y=t(44871),b=t(32867),j=t(56993),k=t(89450),P=t(80635),_=t(71249),S=t(80184),C=l.Z.Dragger,N=function(e){var n=e.value,t=e.onChange,f=e.select,p=e.time,d=(0,w.z)(),v=(0,k.S)().width,h=(0,s.useState)(),Z=(0,i.Z)(h,2),g=Z[0],x=Z[1],y=(0,s.useState)([]),_=(0,i.Z)(y,2),N=_[0],D=_[1],L=function(){var e=(0,o.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,b.Kb)("",(function(e){x(e)}),(function(e){d.error(e)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,s.useEffect)((function(){L()}),[]);var O=(0,s.useCallback)((function(){var e;return function(n,t,r,u){e&&clearTimeout(e),e=setTimeout((function(){var e=(n.length?n.filter((function(e){return!r.includes(e.url)})):[]).map((function(e){return{filename:e.url,classification:t,photoTime:u}}));e.length&&(0,j.O6)(e,(function(){d.success("\u4e0a\u4f20\u6210\u529f"),D([].concat((0,a.Z)(r),(0,a.Z)(e.map((function(e){return e.filename})))))}),(function(e){d.error("\u4e0a\u4f20\u81f3OSS\u6210\u529f\u4f46\u662f\u4e0a\u4f20\u81f3\u5e94\u7528\u670d\u52a1\u5668\u5931\u8d25\uff1a".concat(e))}))}),300)}}),[]),T=(0,s.useMemo)((function(){return O()}),[]),A=function(){var e=(0,o.Z)((0,u.Z)().mark((function e(n,t){var r,a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=2;break}return e.abrupt("return",!1);case 2:if(!(1e3*Number(g.expire)<Date.now())){e.next=6;break}return e.next=6,L();case 6:return(r=!!n.type.match("image"))||d.error("\u8bf7\u4e0a\u4f20\u56fe\u7247\u7c7b\u6587\u4ef6\uff01"),a=n.name.slice(n.name.lastIndexOf(".")),o=(0,c.x0)()+a,n.url=g.dir+o,e.abrupt("return",r||l.Z.LIST_IGNORE);case 12:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.Z)((0,u.Z)().mark((function e(n){var t,r,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var t=new FileReader;t.readAsDataURL(n.originFileObj),t.onload=function(){return e(t.result)}}));case 2:t=e.sent,(r=new Image).src=t,r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.bottom="0",r.style.top="0",r.style.margin="auto",null===(a=window.open(t))||void 0===a||a.document.write(r.outerHTML);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),R={name:"file",fileList:n,action:null===g||void 0===g?void 0:g.host,multiple:!0,onChange:function(e){var n=e.file,r=e.fileList;d.destroy();var u=r.filter((function(e){return"uploading"===e.status})),o=r.filter((function(e){return"done"===e.status})),i=r.filter((function(e){return"error"===e.status}));u.length>0&&d.loading("\u4e0a\u4f20\u4e2d"),o.length>0&&"removed"!==n.status&&T(r,f,N,p),i.length>0&&d.error("\u4e0a\u4f20\u5931\u8d25"),null===t||void 0===t||t((0,a.Z)(r))},onRemove:function(e){var r=(n||[]).filter((function(n){return n.url!==e.url}));t&&t(r)},onPreview:I,data:function(e){return{key:e.url,OSSAccessKeyId:null===g||void 0===g?void 0:g.accessid,policy:null===g||void 0===g?void 0:g.policy,Signature:null===g||void 0===g?void 0:g.signature}},beforeUpload:A};return(0,S.jsxs)(C,(0,r.Z)((0,r.Z)({},R),{},{listType:"picture",height:v>P.sO?300:200,children:[(0,S.jsx)("p",{className:"ant-upload-drag-icon",children:(0,S.jsx)(m.Z,{})}),(0,S.jsx)("p",{className:"ant-upload-text",children:"\u70b9\u51fb\u6216\u8005\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u533a\u57df\u4e0a\u4f20"}),(0,S.jsx)("p",{className:"ant-upload-hint",children:"\u652f\u6301\u5355\u4e2a\u6216\u6279\u91cf\u4e0a\u4f20\u3002\u652f\u6301\u6240\u6709\u7684\u56fe\u7247\u683c\u5f0f\u683c\u5f0f\uff0c\u8bf7\u52ff\u4e0a\u4f20\u5176\u4ed6\u6587\u4ef6\uff01"})]}))},D=function(){var e=(0,y.TL)(),n=(0,s.useState)("now"),t=(0,i.Z)(n,2),r=t[0],a=t[1],u=(0,s.useState)(new Date(Date.now())),o=(0,i.Z)(u,2),c=o[0],l=o[1];return(0,s.useEffect)((function(){e((0,_.Y)("photo"))}),[]),(0,S.jsxs)("div",{className:h,children:[(0,S.jsxs)("div",{className:Z,children:[(0,S.jsx)("span",{children:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u7167\u7247\u5206\u7c7b\uff1a"}),(0,S.jsx)(f.Z,{defaultValue:"now",style:{width:160},onChange:function(e){a(e)},options:[{value:"now",label:"\u5373\u65f6\u4e0a\u4f20"},{value:"memory",label:"\u5f80\u4e8b\u56de\u5fc6"},{value:"bigEvent",label:"\u5927\u4e8b\u8bb0"},{value:"others",label:"\u5176\u4ed6"}]}),(0,S.jsxs)("span",{children:[(0,S.jsx)(p.Z,{color:"magenta",status:"processing",style:{paddingRight:5}}),"\u7528\u4e8e\u524d\u7aef\u4e0d\u540c\u7167\u7247\u5c55\u793a\u533a\u5206\u7c7b"]})]}),(0,S.jsxs)("div",{className:g,children:[(0,S.jsx)("span",{children:"\u8bf7\u9009\u62e9\u4e0a\u4f20\u7167\u7247\u65e5\u671f\uff1a"}),(0,S.jsx)(d.Z,{placeholder:"\u8bf7\u9009\u62e9\u7167\u7247\u65e5\u671f",format:"YYYY/MM/DD",onChange:function(e){l(e.$d)}}),(0,S.jsxs)("span",{children:[(0,S.jsx)(p.Z,{color:"magenta",status:"processing",style:{paddingRight:5}}),"\u7528\u4e8e\u65f6\u95f4\u8f74\u5c55\u793a\uff08\u4e0d\u586b\u9ed8\u8ba4\u4e3a\u5f53\u524d\u65f6\u95f4\uff09"]})]}),(0,S.jsx)("div",{className:x,children:(0,S.jsx)(v.Z,{labelCol:{span:4},children:(0,S.jsx)(v.Z.Item,{name:"photos",children:(0,S.jsx)(N,{select:r,time:c})})})})]})}}}]);
//# sourceMappingURL=1654.bac97979.chunk.js.map